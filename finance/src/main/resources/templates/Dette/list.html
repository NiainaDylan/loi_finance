<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Dette</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        h1 { color: #333; text-align: center; }
        .controls { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:12px; align-items:center; }
        .controls select, .controls input { padding:6px; }
        .table-wrap { overflow-x:auto; }
        table { width: 100%; border-collapse: collapse; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); min-width: 700px; }
        thead { background-color: #FF9800; color: white; }
        th, td { padding: 8px 12px; text-align: left; border: 1px solid #ddd; }
        th { cursor:pointer; }
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        tbody tr:hover { background-color: #f1f1f1; }
        .montant { text-align: right; }
        .container { max-width: 1400px; margin: 0 auto; }
        .total-row { background-color: #fff3e0 !important; font-weight: bold; }
        .pagination { margin-top:10px; display:flex; gap:8px; align-items:center; }
        .page-link { padding:6px 8px; background:#eee; text-decoration:none; color:#333; border-radius:4px; }
        .page-link.active { background:#FF9800; color:white; }
        @media (max-width:700px){ .controls{flex-direction:column; align-items:stretch} }
    </style>
</head>
<body>
<div class="container" th:with="
                prevPage=${currentPage > 0} ? ${currentPage - 1} : 0,
                nextPage=${currentPage < (totalPages - 1)} ? ${currentPage + 1} : ${currentPage},
                pagesSeq=${#numbers.sequence(0, totalPages - 1)}">
    <h1>Suivi Dette</h1>

    <form method="get" class="controls" th:action="@{/suivi-dettes}">
        <label>Dette:
            <select name="detteId">
                <option value="" th:selected="${detteId == null}">Toutes</option>
                <option th:each="d : ${allDettes}" th:value="${d.id}" th:text="${d.nature}" th:selected="${d.id == detteId}"></option>
            </select>
        </label>

        <label>Années de: <input type="number" name="fromYear" th:value="${fromYear}" style="width:100px;" /></label>
        <label>à: <input type="number" name="toYear" th:value="${toYear}" style="width:100px;" /></label>

        <label>Taille page:
            <select name="size">
                <option th:value="10" th:selected="${size==10}">10</option>
                <option th:value="20" th:selected="${size==20}">20</option>
                <option th:value="50" th:selected="${size==50}">50</option>
            </select>
        </label>

        <button type="submit">Appliquer</button>
        <a class="page-link" th:href="@{/suivi-dettes}">Réinitialiser</a>
    </form>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Dette</th>
                    <th th:each="annee : ${annees}" class="montant" th:text="${annee}"></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="dette : ${dettes}">
                    <td th:text="${dette.nature}"></td>
                    <td th:each="annee : ${annees}" class="montant"
                        th:text="${(montantsParDetteAnnee[dette.id] != null and montantsParDetteAnnee[dette.id][annee] != null) ? #numbers.formatDecimal(montantsParDetteAnnee[dette.id][annee],1,'POINT',2,'COMMA') : '0,00'}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(dettes)}"><td th:colspan="${1 + #lists.size(annees)}">Aucune donnée disponible</td></tr>
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td><strong>TOTAL</strong></td>
                    <td th:each="annee : ${annees}" class="montant" th:text="${totauxParAnnee[annee] != null ? #numbers.formatDecimal(totauxParAnnee[annee],1,'POINT',2,'COMMA') : '0,00'}"></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="pagination">
        <a class="page-link" th:if="${currentPage > 0}" th:href="@{/suivi-dettes(detteId=${detteId}, fromYear=${fromYear}, toYear=${toYear}, page=${prevPage}, size=${size})}">Préc</a>
        <span th:each="p : ${pagesSeq}">
            <a class="page-link" th:classappend="${p == currentPage} ? ' active' : ''" th:href="@{/suivi-dettes(detteId=${detteId}, fromYear=${fromYear}, toYear=${toYear}, page=${p}, size=${size})" th:text="${p + 1}"></a>
        </span>
        <a class="page-link" th:if="${currentPage < totalPages - 1}" th:href="@{/suivi-dettes(detteId=${detteId}, fromYear=${fromYear}, toYear=${toYear}, page=${nextPage}, size=${size})}">Suiv</a>
        <span th:text="${totalItems} + ' éléments'"></span>
    </div>

</div>
</body>
</html>
